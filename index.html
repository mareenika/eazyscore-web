<body>
  <!-- Sofort-Bypass für ?admin=1, noch bevor andere Skripte laufen -->
  <script>
    (function () {
      const p = new URLSearchParams(location.search);
      if (p.get('admin') === '1') {
        document.addEventListener('DOMContentLoaded', () => {
          const f = document.getElementById('auditForm');
          const n = document.getElementById('adminNote');
          if (f) { f.style.display = 'block'; f.classList.remove('hidden'); }
          if (n) n.classList.add('hidden');
          const dbg = document.getElementById('adminDebug');
          if (dbg) dbg.textContent = 'Admin-Status: ✔︎ (url_bypass) – erzwungen sichtbar';
        });
      }
    })();
  </script>

  <!-- Sichtbares Fehlerfeld (falls JS crasht) -->
  <div id="fatalErr" style="display:none;background:#fee;border:1px solid #faa;padding:.75rem;margin:.75rem 0;border-radius:8px;color:#600">
    <strong>Fehler:</strong> <span id="fatalMsg"></span>
  </div>
  <script>
    // Zeige uncaught errors / 404 von Scripts
    window.addEventListener('error', (e) => {
      const box = document.getElementById('fatalErr');
      const msg = document.getElementById('fatalMsg');
      if (!box || !msg) return;
      box.style.display = 'block';
      msg.textContent = (e?.message || e?.error?.message || String(e)).slice(0, 500);
    });
  </script>

  <div class="container">
    <h1>EAZY Score</h1>

    <div id="adminDebug" class="note">Admin-Status: <em>prüfe…</em></div>

    <p class="note">
      Öffentliche Liste ansehen: <a href="./public.html">Letzte Bewertungen</a>
    </p>

    <!-- LOGIN -->
    <div id="loginBox" style="margin:1rem 0; border:1px solid #ddd; padding:1rem; border-radius:8px;">
      <div id="loginInputs">
        <label for="emailInput">E-Mail:
          <input id="emailInput" type="email" placeholder="you@example.com" required>
        </label>
        <button id="btnSendOtp" type="button">Code senden</button>

        <div style="margin-top:.75rem">
          <input id="otpInput" type="text" inputmode="numeric" maxlength="8" autocomplete="one-time-code" placeholder="8-stelliger Code">
          <button id="btnVerifyOtp" type="button">Code bestätigen</button>
        </div>

        <div id="loginHint" class="note"></div>
      </div>

      <div id="loginStatus" style="display:none; margin-top:.5rem; font-weight:600; color:green; align-items:center;">
        <span id="loginUser"></span>
        <button id="btnLogout" type="button" style="margin-left:1rem;">Logout</button>
      </div>
    </div>
    <!-- ENDE LOGIN -->

    <!-- Hinweis für Nicht-Admins -->
    <div id="adminNote" class="note warn hidden">
      Du bist eingeloggt, aber kein Admin. Bewertungen können nur Admins erstellen.
      Ergebnisse siehst du hier: <a href="./public.html">Letzte Bewertungen</a>.
    </div>

    <!-- FORMULAR (nur Admin sichtbar – oder via ?admin=1 oben erzwungen) -->
    <form id="auditForm" novalidate style="display:none;">
      <fieldset>
        <legend>App-Details</legend>
        <div class="fieldstack">
          <label for="appName">App-Name</label>
          <input id="appName" name="appName" placeholder="z. B. BeispielApp">
        </div>
        <div class="fieldstack">
          <label for="version">Version</label>
          <input id="version" name="version" placeholder="z. B. 1.0.0">
        </div>
        <div class="fieldstack">
          <label for="category">Kategorie</label>
          <input id="category" name="category" placeholder="z. B. Gesundheit">
        </div>
      </fieldset>

      <fieldset>
        <legend>Antwortmöglichkeiten (Ja / Nein / Unbekannt)</legend>
        <div id="questions"></div>
      </fieldset>

      <div class="footer">
        <button type="submit" class="btn-primary">Bewerten</button>
      </div>
    </form>

    <!-- ERGEBNIS -->
    <section id="resultSection" class="score-card hidden" aria-live="polite">
      <div class="top-row">
        <div class="score-block">
          <div class="score-label">Gesamt-Score</div>
          <div id="scoreValue" class="score-value">0%</div>
          <div class="small-meta"><span id="correctMeta">0 von 0 richtigen Antworten</span></div>
        </div>
        <div class="grade-block">
          <div class="grade-label">Note</div>
          <div id="gradeBadge" class="grade-badge grade-F">F</div>
        </div>
      </div>

      <div class="progress-wrapper" aria-label="Score Fortschritt">
        <div class="progress-container">
          <div id="progressBar" class="progress-bar grade-F" style="width:0%;">
            <span id="progressText">0/0</span>
          </div>
        </div>
      </div>

      <div class="meta-grid">
        <div class="meta-col">
          <div class="section-title">App-Details</div>
          <div><span class="label-key">App-Name: </span><span id="rAppName">–</span></div>
          <div><span class="label-key">Version: </span><span id="rVersion">–</span></div>
          <div><span class="label-key">Kategorie: </span><span id="rCategory">–</span></div>
        </div>
        <div class="meta-col">
          <div class="section-title">Kurzbefunde</div>
          <div id="shortFindings"></div>
        </div>
      </div>

      <div class="footer">
        <button id="restartBtn" class="btn-primary" type="button">Neu bewerten</button>
        <button type="button" class="btn-secondary" style="margin-left:.5rem" onclick="location.href='./public.html'">← Zur öffentlichen Übersicht</button>
      </div>
    </section>
  </div>

  <!-- App-Logik -->
  <script src="./js/app.js"></script>

  <!-- Supabase-Login + Persistenz (unverändert lassen, dein vorhandenes Script) -->
  <script type="module">
    /* dein existierender Supabase-Code bleibt hier wie zuletzt von mir geliefert */
  </script>
</body>
